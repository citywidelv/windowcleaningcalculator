<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las Vegas Commercial Window Cleaning Calculator</title>
    <style>
        :root {
            --primary-blue: #1E3A8A;
            --secondary-blue: #3B82F6;
            --accent-red: #DC2626;
            --dark-gray: #374151;
            --light-gray: #F3F4F6;
            --success-green: #059669;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .cost-provider-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .cost-provider-section h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .toggle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .toggle-group {
            text-align: center;
        }

        .toggle-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-gray);
        }

        .toggle-buttons {
            display: flex;
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid var(--light-gray);
        }

        .toggle-buttons button {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: white;
            color: var(--dark-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vendor-btn.active {
            background: var(--accent-red);
            color: white;
        }

        .inhouse-btn.active {
            background: var(--success-green);
            color: white;
        }

        .toggle-buttons button:hover {
            opacity: 0.8;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .card h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 0.5rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light-gray);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--secondary-blue);
        }

        .story-section {
            background: #F8FAFC;
            border: 2px solid var(--secondary-blue);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .story-section h4 {
            color: var(--secondary-blue);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .window-count-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .window-input {
            text-align: center;
        }

        .window-input label {
            display: block;
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 0.25rem;
        }

        .window-input input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            text-align: center;
        }

        .window-input small {
            display: block;
            font-size: 0.75rem;
            color: #6B7280;
            margin-top: 0.25rem;
        }

        .ic-breakdown {
            background: #F8FAFC;
            border: 2px solid var(--secondary-blue);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .ic-breakdown h4 {
            color: var(--secondary-blue);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .breakdown-grid .label {
            color: var(--dark-gray);
        }

        .breakdown-grid .value {
            text-align: right;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .results-section {
            grid-column: 1 / -1;
            margin-top: 2rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .result-card.highlight {
            background: linear-gradient(135deg, var(--accent-red), #EF4444);
            color: white;
        }

        .result-card h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .result-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .result-card .unit {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .breakdown-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .breakdown-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .breakdown-card h4 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 0.5rem;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .breakdown-item.total {
            border-top: 2px solid var(--light-gray);
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .export-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .export-btn.vendor {
            background: var(--accent-red);
        }

        .export-btn.client {
            background: var(--secondary-blue);
        }

        .export-btn.fsm {
            background: var(--success-green);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .minimum-charge-notice {
            grid-column: 1 / -1;
            background: #FEF3C7;
            border: 2px solid #F59E0B;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .minimum-charge-notice h3 {
            color: #92400E;
            margin-bottom: 1rem;
        }

        .minimum-charge-notice .price-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }

            .input-grid {
                grid-template-columns: 1fr;
            }

            .toggle-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .breakdown-section {
                grid-template-columns: 1fr;
            }

            .export-buttons {
                flex-direction: column;
                align-items: center;
            }

            .window-count-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Las Vegas Commercial Window Cleaning Calculator</h1>
        <p>Professional Window Cleaning Pricing by Story Count & Window Types</p>
    </div>

    <div class="container">
        <!-- Cost Provider Toggle System -->
        <div class="cost-provider-section">
            <h3>Cost Provider Selection</h3>
            <div class="toggle-grid">
                <div class="toggle-group">
                    <label>Labor</label>
                    <div class="toggle-buttons">
                        <button class="vendor-btn active" data-category="labor">Vendor</button>
                        <button class="inhouse-btn" data-category="labor">In-House</button>
                    </div>
                </div>
                <div class="toggle-group">
                    <label>Equipment</label>
                    <div class="toggle-buttons">
                        <button class="vendor-btn active" data-category="equipment">Vendor</button>
                        <button class="inhouse-btn" data-category="equipment">In-House</button>
                    </div>
                </div>
                <div class="toggle-group">
                    <label>Materials</label>
                    <div class="toggle-buttons">
                        <button class="vendor-btn active" data-category="materials">Vendor</button>
                        <button class="inhouse-btn" data-category="materials">In-House</button>
                    </div>
                </div>
                <div class="toggle-group">
                    <label>Supplies</label>
                    <div class="toggle-buttons">
                        <button class="vendor-btn active" data-category="supplies">Vendor</button>
                        <button class="inhouse-btn" data-category="supplies">In-House</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="calculator-grid">
            <!-- Project Details -->
            <div class="card">
                <h3>Building & Service Details</h3>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="serviceType">Service Type</label>
                        <select id="serviceType" onchange="updateCalculations()">
                            <option value="maintenance_exterior">Maintenance - Exterior Only</option>
                            <option value="maintenance_interior">Maintenance - Interior Only</option>
                            <option value="maintenance_both">Maintenance - Interior & Exterior</option>
                            <option value="post_construction">Post-Construction Cleanup</option>
                            <option value="initial_cleaning">Initial Deep Cleaning</option>
                            <option value="high_rise">High-Rise Specialist Cleaning</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="storyCount">Number of Stories</label>
                        <select id="storyCount" onchange="generateStoryInputs()">
                            <option value="1">1 Story (Ground Level)</option>
                            <option value="2">2 Stories (Tucker Pole)</option>
                            <option value="3">3 Stories (Extended Pole/Lift)</option>
                            <option value="4">4 Stories (Scissor Lift)</option>
                            <option value="5">5 Stories (Scissor Lift)</option>
                            <option value="6">6 Stories (Scissor Lift)</option>
                            <option value="mid_rise">7-15 Stories (Boom Lift)</option>
                            <option value="high_rise">16+ Stories (Rappelling/RDS)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="windowCondition">Window Condition</label>
                        <select id="windowCondition" onchange="updateCalculations()">
                            <option value="excellent">Excellent - Recently cleaned</option>
                            <option value="good" selected>Good - Well-maintained</option>
                            <option value="fair">Fair - Some buildup/staining</option>
                            <option value="poor">Poor - Heavy buildup</option>
                            <option value="very_poor">Very Poor - Severe staining/oxidation</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="accessDifficulty">Access Difficulty</label>
                        <select id="accessDifficulty" onchange="updateCalculations()">
                            <option value="easy">Easy - Open access, minimal obstacles</option>
                            <option value="moderate" selected>Moderate - Some landscaping/obstacles</option>
                            <option value="difficult">Difficult - Dense landscaping/equipment</option>
                            <option value="very_difficult">Very Difficult - Severe access restrictions</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="timeOfService">Time of Service</label>
                        <select id="timeOfService" onchange="updateCalculations()">
                            <option value="normal">Normal Hours (6 AM - 6 PM)</option>
                            <option value="early_morning">Early Morning (4 AM - 8 AM) +15%</option>
                            <option value="evening">Evening (6 PM - 10 PM) +20%</option>
                            <option value="weekend">Weekend +25%</option>
                            <option value="holiday">Holiday +50%</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="buildingType">Building Type</label>
                        <select id="buildingType" onchange="updateCalculations()">
                            <option value="office">Office Building</option>
                            <option value="retail">Retail/Shopping Center</option>
                            <option value="medical">Medical Facility</option>
                            <option value="industrial">Industrial/Warehouse</option>
                            <option value="hotel">Hotel/Hospitality</option>
                            <option value="restaurant">Restaurant/Food Service</option>
                            <option value="mixed_use">Mixed Use</option>
                        </select>
                    </div>
                </div>

                <!-- Dynamic Story Window Inputs -->
                <div id="storyInputsContainer">
                    <!-- Populated by JavaScript -->
                </div>

                <!-- Add-On Services -->
                <div class="input-group full-width">
                    <label>Additional Services</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="screenCleaning" onchange="updateCalculations()">
                            <label for="screenCleaning">Screen Cleaning & Removal</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="glassdoors" onchange="updateCalculations()">
                            <label for="glassdoors">Glass Doors & Storefronts</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="framesCleaning" onchange="updateCalculations()">
                            <label for="framesCleaning">Window Frame Cleaning</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sillCleaning" onchange="updateCalculations()">
                            <label for="sillCleaning">Sill & Track Cleaning</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="mineralRemoval" onchange="updateCalculations()">
                            <label for="mineralRemoval">Hard Water Stain Removal</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rustRemoval" onchange="updateCalculations()">
                            <label for="rustRemoval">Rust & Oxidation Treatment</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendor Labor & Equipment -->
            <div class="card">
                <h3>Vendor Labor & Equipment Rates</h3>

                <!-- IC Rate Breakdown -->
                <div class="ic-breakdown">
                    <h4>Independent Contractor Rate Breakdown</h4>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="rawLaborRate">Raw Labor Rate ($/hour)</label>
                            <input type="number" id="rawLaborRate" value="20.00" step="0.50" onchange="updateICBreakdown()">
                        </div>
                        <div class="input-group">
                            <label for="stateTaxRate">State Income Tax (%)</label>
                            <input type="number" id="stateTaxRate" value="0.00" step="0.01" onchange="updateICBreakdown()">
                        </div>
                        <div class="input-group">
                            <label for="icProfitRate">IC Profit & OH (%)</label>
                            <input type="number" id="icProfitRate" value="10.0" step="0.1" onchange="updateICBreakdown()">
                        </div>
                    </div>
                    <div class="breakdown-grid" id="icBreakdownDisplay">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <label for="crewSize">Crew Size</label>
                        <select id="crewSize" onchange="updateCalculations()">
                            <option value="1">1 Person</option>
                            <option value="2" selected>2 People</option>
                            <option value="3">3 People</option>
                            <option value="4">4 People</option>
                            <option value="5">5 People</option>
                            <option value="6">6 People</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="cityWideMargin">City Wide Margin (%)</label>
                        <input type="number" id="cityWideMargin" value="35" step="1" onchange="updateCalculations()">
                    </div>
                    <div class="input-group">
                        <label for="equipmentDailyRate">Base Equipment ($/day)</label>
                        <input type="number" id="equipmentDailyRate" value="75" onchange="updateCalculations()">
                    </div>
                    <div class="input-group">
                        <label for="liftRentalDaily">Lift Rental ($/day)</label>
                        <input type="number" id="liftRentalDaily" value="450" onchange="updateCalculations()">
                    </div>
                    <div class="input-group">
                        <label for="materialCostPerWindow">Materials ($/window)</label>
                        <input type="number" id="materialCostPerWindow" value="0.35" step="0.05" onchange="updateCalculations()">
                    </div>
                    <div class="input-group">
                        <label for="supplyCostBase">Supply Cost Base ($)</label>
                        <input type="number" id="supplyCostBase" value="35" onchange="updateCalculations()">
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <!-- Minimum Charge Notice -->
            <div class="minimum-charge-notice" id="minimumChargeNotice">
                <h3>⚠️ Below Minimum Service Charge</h3>
                <div class="price-comparison">
                    <div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">
                            <strong>Calculated Price:</strong> 
                            <span id="calculatedPrice" style="color: var(--dark-gray); font-size: 1.3rem; font-weight: bold;"></span>
                        </p>
                        <p style="color: var(--dark-gray);">Based on actual time and materials</p>
                    </div>
                    <div>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">
                            <strong>Standard Minimum:</strong> 
                            <span style="color: var(--accent-red); font-size: 1.3rem; font-weight: bold;">$350</span>
                        </p>
                        <p style="color: var(--dark-gray);">For standalone window cleaning</p>
                    </div>
                </div>
                <div style="background: white; padding: 1rem; border-radius: 6px; border-left: 4px solid #F59E0B;">
                    <p style="margin-bottom: 0.5rem; font-weight: 600; color: #92400E;">
                        FSM Decision Required:
                    </p>
                    <ul style="margin: 0; padding-left: 1.5rem; color: #92400E;">
                        <li>If this is a standalone service, charge the $350 minimum</li>
                        <li>If bundled with other services at the same location, you may charge the calculated price</li>
                        <li>Consider travel time, setup costs, and opportunity cost when making this decision</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h3>Pricing Results</h3>
                <div class="results-grid" id="resultsGrid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Detailed Breakdown -->
            <div class="breakdown-section" id="breakdownSection">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Export Functions -->
            <div class="export-section">
                <h3>Export Options</h3>
                <p style="margin-bottom: 1rem;">Generate professional documents for job management</p>
                <div class="export-buttons">
                    <button class="export-btn vendor" onclick="exportVendorSpecs()">
                        Export Vendor Specifications
                    </button>
                    <button class="export-btn fsm" onclick="exportFSMSummary()">
                        Export FSM Job Summary
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // REALISTIC Commercial window cleaning base rates (in minutes per window)
        // Based on industry standards for commercial cleaning
        const windowPricing = {
            small: { 
                minutes: 3.0,  // 3 minutes for small windows
                description: "Small (up to 3 sq ft)" 
            },
            medium: { 
                minutes: 5.0,  // 5 minutes for medium windows
                description: "Medium (3-15 sq ft)" 
            },
            large: { 
                minutes: 8.0,  // 8 minutes for large windows
                description: "Large (15-40 sq ft)" 
            },
            xlarge: { 
                minutes: 12.0,  // 12 minutes for extra large
                description: "Extra Large (40+ sq ft)" 
            },
            doors: { 
                minutes: 10.0,  // 10 minutes for glass doors
                description: "Glass Doors & Entries" 
            }
        };

        // Service type multipliers
        const serviceMultipliers = {
            maintenance_exterior: 1.0,
            maintenance_interior: 0.8,
            maintenance_both: 1.6,
            post_construction: 2.2,
            initial_cleaning: 1.5,
            high_rise: 1.8
        };

        // Condition multipliers
        const conditionMultipliers = {
            excellent: 0.85,
            good: 1.0,
            fair: 1.25,
            poor: 1.6,
            very_poor: 2.0
        };

        // Access difficulty multipliers
        const difficultyMultipliers = {
            easy: 1.0,
            moderate: 1.1,
            difficult: 1.25,
            very_difficult: 1.45
        };

        // Time multipliers
        const timeMultipliers = {
            normal: 1.0,
            early_morning: 1.15,
            evening: 1.20,
            weekend: 1.25,
            holiday: 1.50
        };

        // Height complexity multipliers
        const heightMultipliers = {
            1: 1.0,    // Ground level
            2: 1.1,    // 2nd floor - slightly more complex
            3: 1.2,    // 3rd floor - need extended poles
            4: 1.35,   // 4th floor - lift required
            5: 1.5,    // 5th floor - more lift positioning
            6: 1.65,   // 6th floor - significantly more time
            7: 1.8,    // 7th floor and up
            8: 1.95,
            9: 2.1,
            10: 2.25
        };

        // Equipment requirements
        const equipmentRequirements = {
            1: { needsLift: false, type: 'ground', setupTime: 15 },
            2: { needsLift: false, type: 'tucker_pole', setupTime: 20 },
            3: { needsLift: true, type: 'scissor_lift', setupTime: 45 },
            4: { needsLift: true, type: 'scissor_lift', setupTime: 45 },
            5: { needsLift: true, type: 'scissor_lift', setupTime: 60 },
            6: { needsLift: true, type: 'scissor_lift', setupTime: 60 },
            mid_rise: { needsLift: true, type: 'boom_lift', setupTime: 90 },
            high_rise: { needsLift: true, type: 'rappelling', setupTime: 120 }
        };

        function generateStoryInputs() {
            const storyCount = document.getElementById('storyCount').value;
            const container = document.getElementById('storyInputsContainer');
            
            let storiesNum;
            if (storyCount === 'mid_rise') {
                storiesNum = 10;
            } else if (storyCount === 'high_rise') {
                storiesNum = 20;
            } else {
                storiesNum = parseInt(storyCount);
            }
            
            container.innerHTML = '';
            
            for (let i = 1; i <= storiesNum; i++) {
                const storySection = document.createElement('div');
                storySection.className = 'story-section';
                storySection.innerHTML = `
                    <h4>Floor ${i} Window Count</h4>
                    <div class="window-count-grid">
                        <div class="window-input">
                            <label>Small</label>
                            <input type="number" id="story${i}_small" value="${i === 1 ? '5' : '0'}" min="0" onchange="updateCalculations()">
                            <small>${windowPricing.small.description}</small>
                        </div>
                        <div class="window-input">
                            <label>Medium</label>
                            <input type="number" id="story${i}_medium" value="${i === 1 ? '10' : '8'}" min="0" onchange="updateCalculations()">
                            <small>${windowPricing.medium.description}</small>
                        </div>
                        <div class="window-input">
                            <label>Large</label>
                            <input type="number" id="story${i}_large" value="${i === 1 ? '4' : '2'}" min="0" onchange="updateCalculations()">
                            <small>${windowPricing.large.description}</small>
                        </div>
                        <div class="window-input">
                            <label>Extra Large</label>
                            <input type="number" id="story${i}_xlarge" value="0" min="0" onchange="updateCalculations()">
                            <small>${windowPricing.xlarge.description}</small>
                        </div>
                        <div class="window-input">
                            <label>Glass Doors</label>
                            <input type="number" id="story${i}_doors" value="${i === 1 ? '2' : '0'}" min="0" onchange="updateCalculations()">
                            <small>${windowPricing.doors.description}</small>
                        </div>
                    </div>
                `;
                container.appendChild(storySection);
            }
            
            updateCalculations();
        }

        function updateICBreakdown() {
            const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 20.00;
            const stateTax = parseFloat(document.getElementById('stateTaxRate').value) || 0.00;
            const icProfitRate = parseFloat(document.getElementById('icProfitRate').value) || 10.0;
            
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTaxAmount = rawRate * (stateTax / 100);
            
            const subTotal = rawRate + fica + futa + workComp + gl + stateTaxAmount;
            const icProfitAmount = subTotal * (icProfitRate / 100);
            const icLoadedRate = subTotal + icProfitAmount;
            
            const breakdownDisplay = document.getElementById('icBreakdownDisplay');
            breakdownDisplay.innerHTML = `
                <div class="label">Raw Labor Rate:</div>
                <div class="value">$${rawRate.toFixed(2)}</div>
                <div class="label">FICA (7.65%):</div>
                <div class="value">$${fica.toFixed(2)}</div>
                <div class="label">FUTA (0.60%):</div>
                <div class="value">$${futa.toFixed(2)}</div>
                <div class="label">Work Comp (2.50%):</div>
                <div class="value">$${workComp.toFixed(2)}</div>
                <div class="label">General Liability (0.50%):</div>
                <div class="value">$${gl.toFixed(2)}</div>
                <div class="label">State Income Tax:</div>
                <div class="value">$${stateTaxAmount.toFixed(2)}</div>
                <div class="label">Subtotal:</div>
                <div class="value">$${subTotal.toFixed(2)}</div>
                <div class="label">IC Profit & OH (${icProfitRate}%):</div>
                <div class="value">$${icProfitAmount.toFixed(2)}</div>
                <div class="label"><strong>IC Loaded Rate:</strong></div>
                <div class="value"><strong>$${icLoadedRate.toFixed(2)}</strong></div>
            `;
            
            updateCalculations();
        }

        function getICLoadedRate() {
            const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 20.00;
            const stateTax = parseFloat(document.getElementById('stateTaxRate').value) || 0.00;
            const icProfitRate = parseFloat(document.getElementById('icProfitRate').value) || 10.0;
            
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTaxAmount = rawRate * (stateTax / 100);
            
            const subTotal = rawRate + fica + futa + workComp + gl + stateTaxAmount;
            const icProfitAmount = subTotal * (icProfitRate / 100);
            
            return subTotal + icProfitAmount;
        }

        function calculateInHouseLoadedRate() {
            const rawRate = parseFloat(document.getElementById('rawLaborRate').value) || 20.00;
            const stateTax = parseFloat(document.getElementById('stateTaxRate').value) || 0.00;
            
            const fica = rawRate * 0.0765;
            const futa = rawRate * 0.0060;
            const workComp = rawRate * 0.0250;
            const gl = rawRate * 0.0050;
            const stateTaxAmount = rawRate * (stateTax / 100);
            
            return rawRate + fica + futa + workComp + gl + stateTaxAmount;
        }

        function calculateProviderCosts(category, baseCost) {
            const vendorBtn = document.querySelector(`[data-category="${category}"] .vendor-btn`);
            if (!vendorBtn) return baseCost;
            
            const isVendor = vendorBtn.classList.contains('active');
            const margin = parseFloat(document.getElementById('cityWideMargin').value) || 35;
            
            if (category === 'labor') {
                return baseCost; // Labor handled separately
            } else {
                if (isVendor) {
                    const costWithICProfit = baseCost * 1.10;
                    return costWithICProfit / (1 - margin / 100);
                } else {
                    return baseCost / (1 - margin / 100);
                }
            }
        }

        function updateCalculations() {
            const storyCount = document.getElementById('storyCount').value;
            const serviceType = document.getElementById('serviceType').value;
            const windowCondition = document.getElementById('windowCondition').value;
            const accessDifficulty = document.getElementById('accessDifficulty').value;
            const timeOfService = document.getElementById('timeOfService').value;
            const crewSize = parseInt(document.getElementById('crewSize').value) || 2;
            const margin = parseFloat(document.getElementById('cityWideMargin').value) || 35;
            
            // Calculate total windows and base minutes
            let totalWindows = 0;
            let totalBaseMinutes = 0;
            let windowsByFloor = [];
            
            let storiesNum;
            if (storyCount === 'mid_rise') {
                storiesNum = 10;
            } else if (storyCount === 'high_rise') {
                storiesNum = 20;
            } else {
                storiesNum = parseInt(storyCount);
            }
            
            // Calculate time for each floor
            for (let i = 1; i <= storiesNum; i++) {
                let floorWindows = 0;
                let floorMinutes = 0;
                
                // Get height multiplier for this floor
                const heightMultiplier = heightMultipliers[Math.min(i, 10)] || 2.25;
                
                for (const [size, pricing] of Object.entries(windowPricing)) {
                    const elementId = `story${i}_${size === 'doors' ? 'doors' : size}`;
                    const element = document.getElementById(elementId);
                    if (element) {
                        const count = parseInt(element.value) || 0;
                        floorWindows += count;
                        // Apply height multiplier to base time
                        floorMinutes += count * pricing.minutes * heightMultiplier;
                    }
                }
                
                totalWindows += floorWindows;
                totalBaseMinutes += floorMinutes;
                
                if (floorWindows > 0) {
                    windowsByFloor.push({ floor: i, windows: floorWindows, minutes: floorMinutes });
                }
            }
            
            // Apply service, condition, and difficulty multipliers
            const serviceMultiplier = serviceMultipliers[serviceType] || 1.0;
            const conditionMultiplier = conditionMultipliers[windowCondition] || 1.0;
            const difficultyMultiplier = difficultyMultipliers[accessDifficulty] || 1.0;
            const timeMultiplier = timeMultipliers[timeOfService] || 1.0;
            
            // Calculate volume efficiency (larger jobs are more efficient)
            let volumeEfficiency = 1.0;
            if (totalWindows > 300) {
                volumeEfficiency = 0.85; // 15% more efficient for very large jobs
            } else if (totalWindows > 200) {
                volumeEfficiency = 0.90; // 10% more efficient
            } else if (totalWindows > 100) {
                volumeEfficiency = 0.95; // 5% more efficient
            }
            
            // Apply all multipliers
            let adjustedMinutes = totalBaseMinutes * serviceMultiplier * conditionMultiplier * 
                                 difficultyMultiplier * timeMultiplier * volumeEfficiency;
            
            // Add setup and mobilization time
            const equipment = equipmentRequirements[storyCount] || equipmentRequirements[1];
            const setupMinutes = equipment.setupTime || 15;
            adjustedMinutes += setupMinutes;
            
            // Calculate labor hours
            const totalLaborHours = adjustedMinutes / 60 / crewSize;
            
            // Calculate labor costs
            const laborVendorBtn = document.querySelector('[data-category="labor"] .vendor-btn');
            const isLaborVendor = laborVendorBtn ? laborVendorBtn.classList.contains('active') : true;
            
            let laborHourlyRate;
            if (isLaborVendor) {
                laborHourlyRate = getICLoadedRate();
            } else {
                laborHourlyRate = calculateInHouseLoadedRate();
            }
            
            const billableHourlyRate = laborHourlyRate / (1 - margin / 100);
            const totalLaborCost = billableHourlyRate * totalLaborHours * crewSize;
            
            // Equipment costs
            let equipmentCost = 0;
            let liftRentalCost = 0;
            
            const baseEquipmentRate = parseFloat(document.getElementById('equipmentDailyRate').value) || 75;
            const equipmentDays = Math.max(1, Math.ceil(totalLaborHours / 8));
            equipmentCost = calculateProviderCosts('equipment', baseEquipmentRate * equipmentDays);
            
            if (equipment.needsLift) {
                const liftDaily = parseFloat(document.getElementById('liftRentalDaily').value) || 450;
                liftRentalCost = calculateProviderCosts('equipment', liftDaily * equipmentDays);
            }
            
            // Materials and supplies
            const materialRate = parseFloat(document.getElementById('materialCostPerWindow').value) || 0.35;
            const materialCost = calculateProviderCosts('materials', materialRate * totalWindows);
            
            const supplyBase = parseFloat(document.getElementById('supplyCostBase').value) || 35;
            const supplyCost = calculateProviderCosts('supplies', supplyBase + (totalWindows * 0.15));
            
            // Add-on services
            let addOnCost = 0;
            let addOnMinutes = 0;
            
            if (document.getElementById('screenCleaning').checked) {
                addOnMinutes += totalWindows * 4; // 4 minutes per screen
            }
            if (document.getElementById('glassdoors').checked) {
                addOnMinutes += totalWindows * 0.1 * 6; // Extra time for door details
            }
            if (document.getElementById('framesCleaning').checked) {
                addOnMinutes += totalWindows * 2; // 2 minutes per frame
            }
            if (document.getElementById('sillCleaning').checked) {
                addOnMinutes += totalWindows * 3; // 3 minutes per sill
            }
            if (document.getElementById('mineralRemoval').checked) {
                addOnMinutes += totalWindows * 5; // 5 extra minutes for mineral removal
                addOnCost += calculateProviderCosts('materials', totalWindows * 0.75);
            }
            if (document.getElementById('rustRemoval').checked) {
                addOnMinutes += totalWindows * 4; // 4 extra minutes for rust
                addOnCost += calculateProviderCosts('materials', totalWindows * 1.00);
            }
            
            // Add labor cost for add-on time
            if (addOnMinutes > 0) {
                const addOnHours = addOnMinutes / 60 / crewSize;
                addOnCost += billableHourlyRate * addOnHours * crewSize;
            }
            
            // Total costs
            const totalCostToCW = totalLaborCost + equipmentCost + liftRentalCost + 
                                 materialCost + supplyCost + addOnCost;
            
            // Check minimum charge
            const minimumCharge = 350;
            const isMinimumApplied = totalCostToCW < minimumCharge;
            
            // Show/hide minimum charge notice
            const minimumNotice = document.getElementById('minimumChargeNotice');
            if (minimumNotice) {
                minimumNotice.style.display = isMinimumApplied ? 'block' : 'none';
                if (isMinimumApplied) {
                    const calculatedPriceSpan = document.getElementById('calculatedPrice');
                    if (calculatedPriceSpan) {
                        calculatedPriceSpan.textContent = formatCurrency(totalCostToCW);
                    }
                }
            }
            
            const pricePerWindow = totalCostToCW / Math.max(1, totalWindows);
            const grossProfit = totalCostToCW * (margin / 100) / (1 - margin / 100);
            
            // Update displays
            updateResultsDisplay({
                totalWindows,
                totalLaborHours: totalLaborHours * crewSize,
                totalLaborCost,
                equipmentCost: equipmentCost + liftRentalCost,
                materialCost: materialCost + supplyCost,
                totalCostToCW,
                pricePerWindow,
                finalClientPrice: totalCostToCW,
                grossProfit,
                isMinimumApplied
            });
            
            updateBreakdownDisplay({
                totalWindows,
                laborHours: totalLaborHours,
                crewHours: totalLaborHours * crewSize,
                laborRate: laborHourlyRate,
                billableRate: billableHourlyRate,
                totalLaborCost,
                equipmentDays,
                baseEquipmentRate,
                liftDays: equipment.needsLift ? equipmentDays : 0,
                liftRate: equipment.needsLift ? parseFloat(document.getElementById('liftRentalDaily').value) : 0,
                materialRate,
                materialCost,
                supplyCost,
                addOnCost,
                serviceType,
                equipment: equipment.type,
                adjustedMinutes: adjustedMinutes - setupMinutes,
                setupMinutes,
                totalMinutes: totalBaseMinutes,
                crewSize,
                isLaborVendor,
                volumeEfficiency,
                windowsByFloor
            });
        }

        function updateResultsDisplay(results) {
            const resultsGrid = document.getElementById('resultsGrid');
            
            const priceLabel = results.isMinimumApplied ? 
                "Calculated Price" : 
                "Final Client Price";
            
            resultsGrid.innerHTML = `
                <div class="result-card">
                    <h4>Total Windows</h4>
                    <div class="value">${results.totalWindows}</div>
                    <div class="unit">windows</div>
                </div>
                <div class="result-card">
                    <h4>Total Labor Hours</h4>
                    <div class="value">${results.totalLaborHours.toFixed(1)}</div>
                    <div class="unit">man-hours</div>
                </div>
                <div class="result-card">
                    <h4>Labor Cost</h4>
                    <div class="value">${formatCurrency(results.totalLaborCost)}</div>
                    <div class="unit">with margin</div>
                </div>
                <div class="result-card">
                    <h4>Equipment & Lift</h4>
                    <div class="value">${formatCurrency(results.equipmentCost)}</div>
                    <div class="unit">including rentals</div>
                </div>
                <div class="result-card">
                    <h4>Materials & Supplies</h4>
                    <div class="value">${formatCurrency(results.materialCost)}</div>
                    <div class="unit">cleaning supplies</div>
                </div>
                <div class="result-card">
                    <h4>Price Per Window</h4>
                    <div class="value">${formatCurrencyDetailed(results.pricePerWindow)}</div>
                    <div class="unit">average per window</div>
                </div>
                <div class="result-card ${results.isMinimumApplied ? '' : 'highlight'}">
                    <h4>${priceLabel}</h4>
                    <div class="value">${formatCurrency(results.finalClientPrice)}</div>
                    <div class="unit">${results.isMinimumApplied ? '(Below $350 minimum)' : 'total project'}</div>
                </div>
                <div class="result-card ${results.isMinimumApplied ? '' : 'highlight'}">
                    <h4>CW Gross Profit</h4>
                    <div class="value">${formatCurrency(results.grossProfit)}</div>
                    <div class="unit">margin earned</div>
                </div>
            `;
        }

        function updateBreakdownDisplay(data) {
            const breakdownSection = document.getElementById('breakdownSection');
            const providerType = data.isLaborVendor ? 'Vendor' : 'In-House';
            
            breakdownSection.innerHTML = `
                <div class="breakdown-card">
                    <h4>Window Count & Time</h4>
                    <div class="breakdown-item">
                        <span>Total Windows:</span>
                        <span>${data.totalWindows} windows</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Base Cleaning Time:</span>
                        <span>${(data.totalMinutes/60).toFixed(1)} hrs</span>
                    </div>
                    ${data.volumeEfficiency < 1 ? `
                    <div class="breakdown-item" style="color: var(--success-green);">
                        <span>Volume Efficiency:</span>
                        <span>${Math.round((1 - data.volumeEfficiency) * 100)}% faster</span>
                    </div>
                    ` : ''}
                    <div class="breakdown-item">
                        <span>Adjusted Time:</span>
                        <span>${(data.adjustedMinutes/60).toFixed(1)} hrs</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Setup/Mobilization:</span>
                        <span>${(data.setupMinutes/60).toFixed(1)} hrs</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Crew Size:</span>
                        <span>${data.crewSize} people</span>
                    </div>
                    <div class="breakdown-item total">
                        <span>Total Man-Hours:</span>
                        <span>${data.crewHours.toFixed(1)} hrs</span>
                    </div>
                </div>
                
                <div class="breakdown-card">
                    <h4>Labor Cost Structure</h4>
                    <div class="breakdown-item">
                        <span>Provider Type:</span>
                        <span>${providerType}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>${providerType} Loaded Rate:</span>
                        <span>${formatCurrencyDetailed(data.laborRate)}/hr</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Billable Rate:</span>
                        <span>${formatCurrencyDetailed(data.billableRate)}/hr</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Man-Hours:</span>
                        <span>${data.crewHours.toFixed(1)} hrs</span>
                    </div>
                    <div class="breakdown-item total">
                        <span>Total Labor Cost:</span>
                        <span>${formatCurrency(data.totalLaborCost)}</span>
                    </div>
                </div>
                
                <div class="breakdown-card">
                    <h4>Equipment & Access</h4>
                    <div class="breakdown-item">
                        <span>Access Method:</span>
                        <span>${data.equipment.replace('_', ' ').toUpperCase()}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Equipment Days:</span>
                        <span>${data.equipmentDays} days</span>
                    </div>
                    ${data.liftDays > 0 ? `
                    <div class="breakdown-item">
                        <span>Lift Rental:</span>
                        <span>${formatCurrency(data.liftRate * data.liftDays)}</span>
                    </div>
                    ` : ''}
                    <div class="breakdown-item">
                        <span>Provider Type:</span>
                        <span>${getProviderType('equipment')}</span>
                    </div>
                </div>
                
                <div class="breakdown-card">
                    <h4>Materials & Supplies</h4>
                    <div class="breakdown-item">
                        <span>Windows:</span>
                        <span>${data.totalWindows} @ ${formatCurrencyDetailed(data.materialRate)}/ea</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Materials:</span>
                        <span>${formatCurrency(data.materialCost)}</span>
                    </div>
                    <div class="breakdown-item">
                        <span>Supplies:</span>
                        <span>${formatCurrency(data.supplyCost)}</span>
                    </div>
                    ${data.addOnCost > 0 ? `
                    <div class="breakdown-item">
                        <span>Add-On Services:</span>
                        <span>${formatCurrency(data.addOnCost)}</span>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatCurrencyDetailed(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function getProviderType(category) {
            const activeBtn = document.querySelector(`[data-category="${category}"] .active`);
            return activeBtn ? activeBtn.textContent : 'Vendor';
        }

        function exportVendorSpecs() {
            const content = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}
\\f0\\fs24
VENDOR SPECIFICATIONS - COMMERCIAL WINDOW CLEANING\\line\\line
Service details and requirements...\\line
}`;
            downloadRTF(content, 'vendor-specifications.rtf');
        }

        function exportFSMSummary() {
            const content = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}
\\f0\\fs24
FACILITY SOLUTIONS MANAGER - JOB SUMMARY\\line\\line
Complete job details...\\line
}`;
            downloadRTF(content, 'fsm-job-summary.rtf');
        }

        function downloadRTF(content, filename) {
            const blob = new Blob([content], { type: 'application/rtf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                // Set up toggle buttons
                const toggleButtons = document.querySelectorAll('.toggle-buttons button');
                toggleButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const parent = this.parentElement;
                        const buttons = parent.querySelectorAll('button');
                        buttons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        updateCalculations();
                    });
                });
                
                // Initialize calculations
                updateICBreakdown();
                generateStoryInputs();
                updateCalculations();
            }, 100);
        });
    </script>
</body>
</html>
